import{_ as je}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-035125fd.js";import{_ as De}from"./AppTextField.vue_vue_type_script_setup_true_lang-93dc1e26.js";import{_ as Pe}from"./AppSelect.vue_vue_type_script_setup_true_lang-32a0f469.js";import{p as Te}from"./paginationMeta-4ad053a4.js";import{F as Ie}from"./FileSaver.min-4f66c306.js";import{i as x}from"./index-4532b75c.js";import{X as O}from"./xlsx-d63df831.js";import{u as H}from"./useApi-776c55ea.js";import{c as L}from"./createUrl-149317bf.js";import{$ as G}from"./api-0c1dfdf3.js";import{d as Ne,r as n,b6 as K,R as E,w as Fe,o as f,c as Re,b as o,f as s,e as c,p as a,aI as u,h as C,A as N,a4 as g,x as p,y as _,a9 as W,t as Z,F as ze,a as Oe}from"./index-75b434bc.js";import{V as Ee}from"./VSpacer-6f8dff92.js";import{V as Me}from"./VAvatar-071125b9.js";import{V as h}from"./VCardText-76f31582.js";import{V as pe}from"./VDivider-fc890531.js";import{V as qe}from"./VDataTableServer-e9f6b4ac.js";import{V as Xe}from"./VTooltip-c5403118.js";import{V as ce}from"./VChip-e2ddd660.js";import{V as Je}from"./VPagination-2b54b87a.js";import{V as M}from"./VCard-95c0d706.js";import{V as ee}from"./VDialog-bc06d443.js";import"./form-2b416184.js";import"./VTextField-05e93cc8.js";/* empty css                   */import"./VCounter-3e4b236e.js";import"./transition-6afda34e.js";import"./VField-82993695.js";import"./easing-9f15041e.js";import"./VInput-b46333d7.js";import"./forwardRefs-8348545e.js";import"./index-97808f23.js";import"./VSelect-54e8b29a.js";import"./VList-c7d4c8b4.js";import"./ssrBoot-7f224ca6.js";import"./createSimpleFunctional-4b3a0a39.js";import"./dialog-transition-14fdab67.js";import"./VMenu-3f143933.js";import"./VOverlay-0b79a00d.js";import"./lazy-0bb5e457.js";import"./scopeId-ee2feb8e.js";import"./VCheckboxBtn-0f22f589.js";import"./VSelectionControl-e1264669.js";import"./index-2898f57d.js";import"./VImg-ba4b392a.js";import"./VDataTable-c3cccdda.js";import"./VTable-de2d1039.js";import"./filter-3bfef89c.js";const Qe={class:"d-flex flex-wrap gap-4 mx-5 my-5 row"},Ye={class:"d-flex flex-wrap align-items-center"},He={class:"d-flex gap-4 flex-wrap align-center"},Le={class:"d-flex align-center"},Ge={class:"text-h8 mb-0 mr-2"},Ke=["onClick"],We=c("span",null," Company pending changes awaiting approval",-1),Ze={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},et={class:"text-sm text-medium-emphasis mb-0"},tt=c("br",null,null,-1),at=c("br",null,null,-1),ot=c("br",null,null,-1),lt=c("br",null,null,-1),ta=Ne({__name:"company",async setup(st){let m,A;const me=[{title:"Company Name",key:"name"},{title:"Bank",key:"bank"},{title:"Branch Code",key:"branch_code"},{title:"Business ID Number",key:"business_identification_number"},{title:"Company Type",key:"organization_type"},{title:"Customer Type",key:"customer_type"},{title:"Approval Status",key:"approval_status"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}];n(!0),n(0);const te=n(""),q=n(),ae=n(),de=n(),oe=n(),S=n(),U=n([]),$=n(null),j=n(null),D=n(""),P=n(null),T=n(""),F=n(null),v=n(45),y=n(1),ve=n(),le=n(),b=n(!1),d=n(null),V=n(!1),k=n(!1),ye=l=>{d.value=l,b.value=!0},fe=n([{title:"Active",value:"active"},{title:"In active",value:"inactive"}]),ge=n([{title:"Approved",value:"approved"},{title:"Pending",value:"pending"},{title:"Denied",value:"rejected"}]),xe=n([{title:"Approve",value:"active"},{title:"Reject",value:"inactive"}]),Ce=l=>{var e,i;y.value=l.page,ve.value=(e=l.sortBy[0])==null?void 0:e.key,le.value=(i=l.sortBy[0])==null?void 0:i.order,console.log(l+0)},be=l=>l==="active"?{text:"Active",color:"primary"}:{text:"Inactive",color:"error"},he=l=>l==="approved"?{text:"Approved",color:"success"}:l==="pending"?{text:"Pending",color:"info"}:{text:"Denied",color:"warning"},X=l=>l&&l==="active"?{color:"success",icon:"tabler-thumb-up",title:"Deactivate"}:{color:"error",icon:"tabler-thumb-down",title:"Activate"},se=n(),{data:Ve,execute:nt}=([m,A]=K(()=>H(L("UI/get/banks/list"))),m=await m,A(),m),ke=Ve.value.data.map(l=>({title:l.name,value:l.id})),we=E(()=>({q:te.value,company_type:de.value,branch_code:ae.value,approval_status:oe.value,bank:se.value,status:q.value,page:y.value,itemsPerPage:v.value,orderBy:le.value})),{data:J,execute:B}=([m,A]=K(()=>H(L("/all/UI/companies",{query:we}))),m=await m,A(),m),ne=E(()=>J.value.data),R=E(()=>J.value.total),{data:_e,execute:Ae}=([m,A]=K(()=>H(L("/UI/companies/changes"))),m=await m,A(),m),re=E(()=>J.value.total||0);B(),Ae(),_e.value.companychange,n([]);const Q=async l=>{await G("/UI/companies/activate",{method:"POST",body:{ids:l,status:S.value}}),x.success("Company Updated Successfully",{position:"top-right",autoClose:3e3}),await B(),b.value=!1};Fe(S,l=>{l&&U.value.length&&Q(U.value)});const $e=()=>{const l=O.utils.json_to_sheet(ne.value),e=O.utils.book_new();O.utils.book_append_sheet(e,l,"Companies");const i=O.write(e,{bookType:"xlsx",type:"array"});Ie.saveAs(new Blob([i],{type:"application/octet-stream"}),"Companies.xlsx")},ie=async()=>{se.value=j.value,te.value=D.value,oe.value=P.value,ae.value=T.value,q.value=$.value,q.value=$.value,await B()},Be=()=>{j.value="",D.value="",P.value="",T.value="",F.value="",$.value="",y.value=1,ie()};B();const Se=async l=>{var e,i;try{const r=await G("/company/approve-changes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({company_id:l})});r.message==="Company updated successfully"?(x.success(r.message,{position:"top-right",autoClose:3e3}),await B(),V.value=!1):r.status===403?x.warn(r.message||"You cannot approve this company",{position:"top-right",autoClose:3e3}):x.error(r.message||"Something went wrong",{position:"top-right",autoClose:3e3})}catch(r){const w=((i=(e=r.response)==null?void 0:e.data)==null?void 0:i.message)||"Error approving the company";x.error(w,{position:"top-right",autoClose:3e3})}},Ue=async l=>{var e,i;try{const r=await G("/company/reject-changes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({company_id:l})});r.message==="Company changes rejected successfully"?(x.success(r.message,{position:"top-right",autoClose:3e3}),await B(),k.value=!1):r.status===403?x.warn(r.message||"You cannot reject this company",{position:"top-right",autoClose:3e3}):x.error(r.message||"Something went wrong",{position:"top-right",autoClose:3e3})}catch(r){const w=((i=(e=r.response)==null?void 0:e.data)==null?void 0:i.message)||"Error rejecting the company";x.error(w,{position:"top-right",autoClose:3e3})}};return(l,e)=>{const i=Pe,r=De,w=Oe("IconBtn"),Y=je;return f(),Re(ze,null,[o(M,{class:"mb-6"},{default:s(()=>[c("div",Qe,[c("div",Ye,[o(i,{modelValue:a(j),"onUpdate:modelValue":e[0]||(e[0]=t=>u(j)?j.value=t:null),items:a(ke),class:"me-1","clear-icon":"tabler-circle-x",clearable:"",placeholder:"Bank",style:{"min-width":"150px","max-width":"200px",flex:"1 1 auto"}},null,8,["modelValue","items"]),o(r,{modelValue:a(D),"onUpdate:modelValue":e[1]||(e[1]=t=>u(D)?D.value=t:null),class:"me-3","clear-icon":"tabler-circle-x",clearable:"",color:"primary",placeholder:"Company Name",style:{"min-width":"150px","max-width":"200px",flex:"1 1 auto"},type:"text"},null,8,["modelValue"]),o(i,{modelValue:a(P),"onUpdate:modelValue":e[2]||(e[2]=t=>u(P)?P.value=t:null),items:a(ge),class:"me-1","clear-icon":"tabler-circle-x",clearable:"",placeholder:"Approval Status",style:{"min-width":"150px","max-width":"200px",flex:"1 1 auto"}},null,8,["modelValue","items"]),o(i,{modelValue:a($),"onUpdate:modelValue":e[3]||(e[3]=t=>u($)?$.value=t:null),items:a(fe),class:"me-1","clear-icon":"tabler-circle-x",clearable:"",placeholder:"Status",style:{"min-width":"150px","max-width":"200px",flex:"1 1 auto"}},null,8,["modelValue","items"]),o(r,{modelValue:a(T),"onUpdate:modelValue":e[4]||(e[4]=t=>u(T)?T.value=t:null),class:"me-1","clear-icon":"tabler-circle-x",clearable:"",color:"primary",placeholder:"Branch Code",style:{"min-width":"150px","max-width":"200px",flex:"1 1 auto"}},null,8,["modelValue"]),o(r,{modelValue:a(F),"onUpdate:modelValue":e[5]||(e[5]=t=>u(F)?F.value=t:null),class:"me-1","clear-icon":"tabler-circle-x",clearable:"",color:"primary",placeholder:"Company Type",style:{"min-width":"150px","max-width":"200px",flex:"1 1 auto"},type:"text"},null,8,["modelValue"]),l.$can("manage","Company Changes Checker")&&l.$can("manage","Company Bulk Approve")?(f(),C(i,{key:0,modelValue:a(S),"onUpdate:modelValue":e[6]||(e[6]=t=>u(S)?S.value=t:null),items:a(xe),"item-title":"title","item-value":"value",class:"me-1","clear-icon":"tabler-circle-x",clearable:"",chips:"",placeholder:"Bulk Actions",style:{"min-width":"150px","max-width":"200px",flex:"1 1 auto"}},null,8,["modelValue","items"])):N("",!0),o(g,{color:"primary","prepend-icon":"tabler-search",style:{"text-size-adjust":"auto","text-transform":"none"},onClick:ie}),o(g,{color:"primary","prepend-icon":"tabler-refresh",style:{"text-size-adjust":"auto","text-transform":"none"},onClick:Be}),o(Ee)]),c("div",He,[o(i,{modelValue:a(v),"onUpdate:modelValue":e[7]||(e[7]=t=>u(v)?v.value=t:null),items:[5,10,20,25,50]},null,8,["modelValue"]),o(g,{color:"primary","prepend-icon":"tabler-download",style:{"text-size-adjust":"auto","text-transform":"none"},onClick:$e})])]),a(re)>0?(f(),C(h,{key:0},{default:s(()=>[p(" Current pending changes "),o(Me,{color:"error",size:"x-small"},{default:s(()=>[c("small",null,_(a(re)),1)]),_:1})]),_:1})):N("",!0),o(pe,{class:"mt-4"}),o(a(qe),{"items-per-page":a(v),"onUpdate:itemsPerPage":e[9]||(e[9]=t=>u(v)?v.value=t:null),page:a(y),"onUpdate:page":e[10]||(e[10]=t=>u(y)?y.value=t:null),modelValue:a(U),"onUpdate:modelValue":e[11]||(e[11]=t=>u(U)?U.value=t:null),headers:me,items:a(ne),"items-length":a(R),"item-key":"id",class:"text-wrap","show-select":"","onUpdate:options":Ce},{"item.name":s(({item:t})=>[c("div",Le,[c("h6",Ge,[c("a",{href:"javascript:void(0)",onClick:I=>l.$router.push(`/companies/view/${t.id}`)},_(t.name),9,Ke)]),t.changes!==null?(f(),C(w,{key:0,class:"mx-1",small:"",color:"error"},{default:s(()=>[o(Xe,{bottom:""},{activator:s(({props:I})=>[o(W,Z(I,{icon:"tabler-info-circle",size:"20","aria-label":"Program changes awaiting approval",onClick:z=>l.openaInfoDialog(t)}),null,16,["onClick"])]),default:s(()=>[We]),_:2},1024)]),_:2},1024)):N("",!0)])]),"item.approval_status":s(({item:t})=>[o(ce,Z({density:"default",label:""},he(t.approval_status)),null,16)]),"item.status":s(({item:t})=>[o(ce,Z({density:"default",label:""},be(t.status)),null,16)]),"item.actions":s(({item:t})=>{var I;return[l.$can("manage","Company Changes Checker")?(f(),C(w,{key:0,onClick:z=>l.$router.push(`/companies/view/${t.id}`)},{default:s(()=>[o(W,{icon:"tabler-eye",color:"info"})]),_:2},1032,["onClick"])):N("",!0),l.$can("manage","Company Changes Checker")?(f(),C(w,{key:1,title:(I=X(t.status))==null?void 0:I.title},{default:s(()=>{var z,ue;return[o(W,{icon:(z=X(t.status))==null?void 0:z.icon,color:(ue=X(t.status))==null?void 0:ue.color,onClick:rt=>ye(t)},null,8,["icon","color","onClick"])]}),_:2},1032,["title"])):N("",!0)]}),bottom:s(()=>[o(pe),c("div",Ze,[c("p",et,_(a(Te)({page:a(y),itemsPerPage:a(v)},a(R))),1),o(Je,{modelValue:a(y),"onUpdate:modelValue":e[8]||(e[8]=t=>u(y)?y.value=t:null),length:Math.ceil(a(R)/a(v)),"total-visible":l.$vuetify.display.xs?1:Math.min(Math.ceil(a(R)/a(v)),5),"active-color":"primary","next-icon":"tabler-caret-right","prev-icon":"tabler-caret-left"},null,8,["modelValue","length","total-visible"])])]),_:1},8,["items-per-page","page","modelValue","items","items-length"])]),_:1}),o(ee,{modelValue:a(b),"onUpdate:modelValue":e[16]||(e[16]=t=>u(b)?b.value=t:null),persistent:"",class:"v-dialog-sm"},{default:s(()=>[o(Y,{onClick:e[12]||(e[12]=t=>b.value=!a(b))}),o(M,null,{default:s(()=>[a(d).status!=="active"?(f(),C(h,{key:0},{default:s(()=>[p(" Are you sure you want to activate company: "+_(a(d).name)+"? ",1),tt]),_:1})):(f(),C(h,{key:1},{default:s(()=>[p(" Are you sure you want to deactivate company: "+_(a(d).name)+"? ",1),at]),_:1})),o(h,{class:"d-flex justify-end gap-3 flex-wrap"},{default:s(()=>[o(g,{color:"secondary",variant:"tonal",onClick:e[13]||(e[13]=t=>b.value=!1)},{default:s(()=>[p(" Cancel ")]),_:1}),a(d).status!=="active"?(f(),C(g,{key:0,color:"success",onClick:e[14]||(e[14]=t=>Q([a(d).id]))},{default:s(()=>[p(" Activate ")]),_:1})):(f(),C(g,{key:1,color:"error",onClick:e[15]||(e[15]=t=>Q([a(d).id]))},{default:s(()=>[p(" Deactivate ")]),_:1}))]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ee,{modelValue:a(V),"onUpdate:modelValue":e[20]||(e[20]=t=>u(V)?V.value=t:null),persistent:"",class:"v-dialog-sm"},{default:s(()=>[o(Y,{onClick:e[17]||(e[17]=t=>V.value=!a(V))}),o(M,null,{default:s(()=>[o(h,null,{default:s(()=>[p(" Are you sure you want to Approve changes for this Company: "+_(a(d).name)+"? ",1),ot,p(" This action can not be undone. ")]),_:1}),o(h,{class:"d-flex justify-end gap-3 flex-wrap"},{default:s(()=>[o(g,{color:"secondary",variant:"tonal",onClick:e[18]||(e[18]=t=>V.value=!1)},{default:s(()=>[p(" Cancel ")]),_:1}),o(g,{color:"success",onClick:e[19]||(e[19]=t=>Se(a(d).id))},{default:s(()=>[p(" Approve ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ee,{modelValue:a(k),"onUpdate:modelValue":e[24]||(e[24]=t=>u(k)?k.value=t:null),persistent:"",class:"v-dialog-sm"},{default:s(()=>[o(Y,{onClick:e[21]||(e[21]=t=>k.value=!a(k))}),o(M,null,{default:s(()=>[o(h,null,{default:s(()=>[p(" Are you sure you want to Reject Changes for this Company: "+_(a(d).name)+"? ",1),lt,p(" This action can not be undone. ")]),_:1}),o(h,{class:"d-flex justify-end gap-3 flex-wrap"},{default:s(()=>[o(g,{color:"secondary",variant:"tonal",onClick:e[22]||(e[22]=t=>k.value=!1)},{default:s(()=>[p(" Cancel ")]),_:1}),o(g,{color:"error",onClick:e[23]||(e[23]=t=>Ue(a(d).id))},{default:s(()=>[p(" Reject ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});export{ta as default};
